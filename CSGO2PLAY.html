<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.2">
    <title>B站：爱折腾瘴渔割 制作的CSGO开箱模拟器</title>
    <style>
        :root {
            --purple-border: #9c27b0;
            --red-border: #f44336;
            --orange-border: #ff9800;
            --rainbow-border: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1a1a1a;
            color: #fff;
            margin: 0;
            padding: 0;
        }
        
        .header {
            background-color: #121212;
            padding: 15px 0;
            border-bottom: 2px solid #333;
        }
        
        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #ff9800;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .balance {
            background-color: #333;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .recharge-btn {
            background-color: #ff9800;
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .recharge-btn:hover {
            background-color: #ffab40;
        }
        
        .main-content {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .case-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .case-container {
            flex: 1;
            min-width: 300px;
            background-color: #252525;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        }
        
        .case-title {
            font-size: 22px;
            margin-bottom: 15px;
            color: #ff9800;
        }
        
        .case-image {
            width: 100%;
            height: 200px;
            background-color: #333;
            border-radius: 5px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: url('https://via.placeholder.com/800x400/333/666?text=高级武器箱');
            background-size: cover;
            background-position: center;
        }
        
        .open-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .open-btn {
            background-color: #ff5722;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        .open-btn:hover {
            background-color: #e64a19;
            transform: scale(1.25);
        }
        
        .price-tag {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .items-section {
            flex: 0 0 300px;
            background-color: #252525;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #ff9800;
        }
        
        .recent-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .recent-item {
            width: calc(25% - 10px);
            aspect-ratio: 1;
            background-color: #333;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        
        .item-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 2px 5px;
            font-size: 10px;
            border-radius: 3px;
        }
        
        .item-time {
            position: absolute;
            bottom: 5px;
            left: 5px;
            font-size: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .action-btn {
            display: block;
            background-color: #2196f3;
            color: white;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
            text-decoration: none;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .action-btn:hover {
            background-color: #1976d2;
        }
        
        /* 商品展示样式 */
        .items-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        
        .item-card {
            background-color: #333;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            transition: transform 0.3s;
        }
        
        .item-card:hover {
            transform: translateY(-5px);
        }
        
        .item-image {
            width: 100%;
            aspect-ratio: 1;
            background-color: #444;
            position: relative;
            background-size: cover;
            background-position: center;
        }
        
        .item-name {
            padding: 8px;
            font-size: 14px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .item-value {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .item-wear {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 10px;
        }
        
        /* 边框颜色类 */
        .border-purple {
            border: 2px solid var(--purple-border);
        }
        
        .border-red {
            border: 2px solid var(--red-border);
        }
        
        .border-orange {
            border: 2px solid var(--orange-border);
        }
        
        .border-rainbow {
            border: 2px solid;
            border-image: var(--rainbow-border);
            border-image-slice: 1;
        }
        
        /* 开箱动画容器 - 更新为支持五连抽 */
        .animation-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .animation-box {
            width: 100%;
            max-width: 800px;
            height: 120px;
            position: relative;
            margin: 0 auto;
        }
        
        .item-scroll {
            width: 100%;
            height: 100%;
            display: flex;
            overflow: hidden;
            position: relative;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        
        .scroll-item {
            min-width: 150px;
            height: 100%;
            margin-right: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }
        
        .pointer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 100%;
            background-color: red;
            z-index: 10;
        }
        
        /* 五连抽结果模态框 */
        .result-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }
        
        .result-content {
            background-color: #252525;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .result-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #ff9800;
            text-align: center;
        }
        
        .result-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .result-item {
            background-color: #333;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .result-image {
            width: 100%;
            aspect-ratio: 1;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .result-name {
            padding: 8px;
            text-align: center;
            font-size: 14px;
        }
        
        .result-value {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
        }
        
        /* 充值模态框 */
        .recharge-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1002;
            justify-content: center;
            align-items: center;
        }
        
        .recharge-content {
            background-color: #252525;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
        }
        
        .recharge-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #ff9800;
            text-align: center;
        }
        
        .recharge-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .recharge-option {
            background-color: #333;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .recharge-option:hover {
            background-color: #444;
        }
        
        .recharge-amount {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .recharge-price {
            font-size: 14px;
            color: #ff9800;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .confirm-btn {
            background-color: #4caf50;
            color: white;
        }
        
        .confirm-btn:hover {
            background-color: #388e3c;
        }
        
        .cancel-btn {
            background-color: #f44336;
            color: white;
        }
        
        .cancel-btn:hover {
            background-color: #d32f2f;
        }
        
        /* 仓库和历史记录模态框 */
        .inventory-modal, .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }
        
        .inventory-content, .history-content {
            background-color: #252525;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 1000px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .inventory-title, .history-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #ff9800;
            text-align: center;
        }
        
        .inventory-items, .history-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        /* 新增的提货相关样式 */
        .inventory-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #444;
        }
        
        .inventory-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .inventory-tab.active {
            border-bottom: 3px solid #ff9800;
            color: #ff9800;
        }
        
        .inventory-tab-content {
            display: none;
        }
        
        .inventory-tab-content.active {
            display: block;
        }
        
        .item-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .item-action-btn {
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            border: none;
            color: white;
        }
        
        .redeem-btn {
            background-color: #2196f3;
        }
        
        .convert-btn {
            background-color: #ff9800;
        }
        
        .bulk-convert-btn {
            background-color: #f44336;
            margin-top: 20px;
            width: 100%;
            padding: 10px;
            font-weight: bold;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
                gap: 15px;
            }
            
            .user-info {
                width: 100%;
                justify-content: space-between;
            }
            
            .animation-box {
                height: 80px;
            }
            
            .scroll-item {
                min-width: 100px;
            }
            
            .result-items, .inventory-items, .history-items {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav">
            <div class="logo">B站：爱折腾瘴渔割 制作的CSGO开箱模拟</div>
            <div class="user-info">
                <div class="balance">余额: <span id="user-balance">0</span> 豆</div>
                <button class="recharge-btn" id="recharge-btn">充值</button>
                <a href="#" class="action-btn" id="inventory-btn">我的仓库</a>
                <a href="#" class="action-btn" id="history-btn">历史记录</a>
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="case-section">
            <div class="case-container">
                <h2 class="case-title">高级武器箱</h2>
                <div class="case-image">
                    <div class="price-tag">128.88 豆/次</div>
                </div>
                <div class="open-buttons">
                    <button class="open-btn" id="open-once">开箱一次</button>
                    <button class="open-btn" id="open-five">开箱五次</button>
                </div>
            </div>
            
            <div class="items-section">
                <h3 class="section-title">最近出货</h3>
                <div class="recent-items" id="recent-items">
                    <!-- 动态生成最近出货 -->
                </div>
                <a href="#" class="action-btn">查看全部</a>
            </div>
        </div>
        
        <h2 class="section-title">武器箱内容</h2>
        <div class="items-showcase" id="items-showcase">
            <!-- 动态生成商品展示 -->
        </div>
    </div>
    
    <!-- 开箱动画 -->
    <div class="animation-container" id="animation-container">
        <!-- 动态生成五个滚动容器 -->
    </div>
    
    <!-- 五连抽结果模态框 -->
    <div class="result-modal" id="five-result-modal">
        <div class="result-content">
            <h3 class="result-title">五连抽结果</h3>
            <div class="result-items" id="five-result-items">
                <!-- 动态生成五连抽结果 -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn confirm-btn" id="close-five-result">关闭</button>
            </div>
        </div>
    </div>
    
    <!-- 单次开箱结果模态框 -->
    <div class="result-modal" id="single-result-modal">
        <div class="result-content">
            <h3 class="result-title">开箱结果</h3>
            <div class="result-items" id="single-result-items">
                <!-- 动态生成单次开箱结果 -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn confirm-btn" id="close-single-result">关闭</button>
                <button class="modal-btn convert-btn" id="convert-item-btn" style="display: none;">置换为豆子</button>
            </div>
        </div>
    </div>
    
    <!-- 充值模态框 -->
    <div class="recharge-modal" id="recharge-modal">
        <div class="recharge-content">
            <h3 class="recharge-title">充值中心</h3>
            <div class="recharge-options">
                <div class="recharge-option" data-amount="100">
                    <div class="recharge-amount">100豆</div>
                    <div class="recharge-price">¥100</div>
                </div>
                <div class="recharge-option" data-amount="300">
                    <div class="recharge-amount">300豆</div>
                    <div class="recharge-price">¥300</div>
                </div>
                <div class="recharge-option" data-amount="500">
                    <div class="recharge-amount">500豆</div>
                    <div class="recharge-price">¥500</div>
                </div>
                <div class="recharge-option" data-amount="1000">
                    <div class="recharge-amount">1000豆</div>
                    <div class="recharge-price">¥1000</div>
                </div>
                <div class="recharge-option" data-amount="3000">
                    <div class="recharge-amount">5000豆</div>
                    <div class="recharge-price">¥5000</div>
                </div>
                <div class="recharge-option" data-amount="5000">
                    <div class="recharge-amount">15000豆</div>
                    <div class="recharge-price">¥15000</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel-btn" id="cancel-recharge">取消</button>
                <button class="modal-btn confirm-btn" id="confirm-recharge">确认充值</button>
            </div>
        </div>
    </div>
    
    <!-- 仓库模态框 -->
    <div class="inventory-modal" id="inventory-modal">
        <div class="inventory-content">
            <h3 class="inventory-title">我的仓库</h3>
            <div class="inventory-tabs">
                <div class="inventory-tab active" data-tab="inventory">库存物品</div>
                <div class="inventory-tab" data-tab="redeeming">提货中 (<span id="redeeming-count">0</span>)</div>
                <div class="inventory-tab" data-tab="redeemed">已提货 (<span id="redeemed-count">0</span>)</div>
            </div>
            
            <div class="inventory-tab-content active" id="inventory-tab">
                <div class="inventory-items" id="inventory-items-container">
                    <!-- 动态生成仓库物品 -->
                </div>
                <button class="bulk-convert-btn" id="bulk-convert-btn">一键分解所有低于1000豆的物品</button>
            </div>
            
            <div class="inventory-tab-content" id="redeeming-tab">
                <div class="inventory-items" id="redeeming-items-container">
                    <!-- 动态生成提货中物品 -->
                </div>
            </div>
            
            <div class="inventory-tab-content" id="redeemed-tab">
                <div class="inventory-items" id="redeemed-items-container">
                    <!-- 动态生成已提货物品 -->
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn confirm-btn" id="close-inventory">关闭</button>
            </div>
        </div>
    </div>
    
    <!-- 历史记录模态框 -->
    <div class="history-modal" id="history-modal">
        <div class="history-content">
            <h3 class="history-title">开箱历史</h3>
            <div class="history-items" id="history-items-container">
                <!-- 动态生成历史记录 -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn confirm-btn" id="close-history">关闭</button>
            </div>
        </div>
    </div>
    
    <script>
        // 完整的商品数据
        const items = [
            { name: "蝴蝶刀渐变之色", image: "images/蝴蝶刀渐变之色.jpg", wear: "崭新出场", probability: 0.00221205, value: 3228.47, rarity: "隐秘级" },
            { name: "蝴蝶刀自动化", image: "images/蝴蝶刀自动化.jpg", wear: "略有磨损", probability: 0.00108, value: 2128.47, rarity: "隐秘级" },
            { name: "驾驶手套西装革履", image: "images/驾驶手套西装革履.jpg", wear: "略有磨损", probability: 0.00151, value: 1028.47, rarity: "军需级" },
            { name: "驾驶手套雪豹", image: "images/驾驶手套雪豹.jpg", wear: "崭新出场", probability: 0.35, value: 828.47, rarity: "军需级" },
            { name: "锯齿爪刀表面淬火", image: "images/锯齿爪刀表面淬火.jpg", wear: "略有磨损", probability: 0.46, value: 1028.47, rarity: "军需级" },
            { name: "锯齿爪刀表面淬火", image: "images/锯齿爪刀表面淬火.jpg", wear: "久经沙场", probability: 0.34, value: 841.5, rarity: "军需级" },
            { name: "骷髅匕首", image: "images/骷髅匕首.jpg", wear: "崭新出场", probability: 0.115, value: 1261.51, rarity: "军需级" },
            { name: "流浪者匕首屠夫", image: "images/流浪者匕首屠夫.jpg", wear: "崭新出场", probability: 0.1246, value: 1004.90, rarity: "军需级" },
            { name: "摩托手套崩", image: "images/摩托手套崩.jpg", wear: "崭新出场", probability: 0.1257, value: 2353.23, rarity: "隐秘级" },
            { name: "摩托手套崩", image: "images/摩托手套崩.jpg", wear: "略有磨损", probability: 0.2, value: 930.218, rarity: "军需级" },
            { name: "咆哮M4", image: "images/咆哮M4.jpg", wear: "崭新出场", probability: 0.000201, value: 10380.237, rarity: "隐秘级" },
            { name: "咆哮M4", image: "images/咆哮M4.jpg", wear: "略有磨损", probability: 0.00208, value: 7133.96, rarity: "隐秘级" },
            { name: "咆哮M4", image: "images/咆哮M4.jpg", wear: "崭新出场", probability: 0.00205, value: 9276.27, rarity: "隐秘级" },
            { name: "咆哮M4", image: "images/咆哮M4.jpg", wear: "略有磨损", probability: 0.00213, value: 2836.32, rarity: "军需级" },
            { name: "运动手套迈阿密风云", image: "images/运动手套迈阿密风云.jpg", wear: "崭新出场", probability: 0.2001, value: 31058.99, rarity: "隐秘级" },
            { name: "运动手套迈阿密风云", image: "images/运动手套迈阿密风云.jpg", wear: "略有磨损", probability: 0.1121, value: 6139.32, rarity: "隐秘级" },
            { name: "运动手套潘多拉", image: "images/运动手套潘多拉.jpg", wear: "久经沙场", probability: 0.0012015, value: 13938.23, rarity: "隐秘级" },
            { name: "运动手套潘多拉", image: "images/运动手套潘多拉.jpg", wear: "略有磨损", probability: 0.002001, value: 18883.30, rarity: "隐秘级" },
            { name: "运动手套树篱迷宫", image: "images/运动手套树篱迷宫.jpg", wear: "崭新出场", probability: 0.0200011, value: 79110.223, rarity: "隐秘级" },
            { name: "运动手套树篱迷宫", image: "images/运动手套树篱迷宫.jpg", wear: "略有磨损", probability: 0.2001, value: 27892.38, rarity: "隐秘级" },
            { name: "运动手套双硒", image: "images/运动手套双硒.jpg", wear: "久经沙场", probability: 0.00111116, value: 1178.26, rarity: "军需级" },
            { name: "运动手套双硒", image: "images/运动手套双硒.jpg", wear: "略有磨损", probability: 0.001214, value: 27892.38, rarity: "隐秘级" },
            { name: "爪子刀传说", image: "images/爪子刀传说.jpg", wear: "久经沙场", probability: 0.223, value: 1616.48, rarity: "军需级" },
            { name: "爪子刀多普勒（红宝石）", image: "images/爪子刀多普勒（红宝石）.jpg", wear: "久经沙场", probability: 0.00112001, value: 15901.83, rarity: "隐秘级" },
            { name: "专业手套渐变之色", image: "images/专业手套渐变之色.jpg", wear: "略有磨损", probability: 0.01224, value: 1817.8, rarity: "军需级" },
            { name: "专业手套深红和服", image: "images/专业手套深红和服.jpg", wear: "略有磨损", probability: 0.002024, value: 12133.27, rarity: "隐秘级" },
            { name: "专业手套深红之网", image: "images/专业手套深红之王.jpg", wear: "略有磨损", probability: 0.012567, value: 1000.218, rarity: "军需级" },
            { name: "AK47暗影破坏者", image: "images/AK47暗影破坏者.jpg", wear: "略有磨损", probability: 16.2, value: 8.38, rarity: "工业级" },
            { name: "蝴蝶刀虎牙", image: "images/蝴蝶刀虎牙.jpg", wear: "崭新出场", probability: 0.02123, value: 1850.232, rarity: "军需级" },
            { name: "AK47黄金藤曼", image: "images/AK47黄金藤曼.jpg", wear: "略有磨损", probability: 0.011112042, value: 4498.76, rarity: "军需级" },
            { name: "AK47可燃冰", image: "images/AK47可燃冰.jpg", wear: "略有磨损", probability: 12.2, value: 14.49, rarity: "工业级" },
            { name: "AK47莫言", image: "images/AK47莫言.jpg", wear: "略有磨损", probability: 13.2, value: 8.51, rarity: "工业级" },
            { name: "AK47水栽竹", image: "images/AK47水栽竹.jpg", wear: "崭新出场", probability: 0.02115, value: 5136.20, rarity: "军需级" },
            { name: "AK47野合", image: "images/AK47野合.jpg", wear: "崭新出场", probability: 0.0420012, value: 21741.24, rarity: "隐秘级" },
            { name: "AWP雷击", image: "images/AWP雷击.jpg", wear: "崭新出场", probability: 0.488888899, value: 876.42, rarity: "军需级" },
            { name: "AWP巨龙传说", image: "images/AWP巨龙传说.jpg", wear: "崭新出场", probability: 0.00112002, value: 20821.71, rarity: "隐秘级" },
            { name: "AWP永恒之枪", image: "images/AWP永恒之枪.jpg", wear: "崭新出场", probability: 0.00112002, value: 21119.88, rarity: "隐秘级" },
            { name: "M4A1氮化处理", image: "images/M4A1氮化处理.jpg", wear: "崭新出场", probability: 12.2, value: 7.12, rarity: "工业级" },
            { name: "M4A1伊卡洛斯的陨落", image: "images/M4A1伊卡洛斯的陨落.jpg", wear: "崭新出场", probability: 0.6725, value: 817.63, rarity: "军需级" },
            { name: "M4A4死寂空间", image: "images/M4A4死寂空间.jpg", wear: "久经沙场", probability: 10.2, value: 17.59, rarity: "工业级" },
            { name: "M9刺刀多普勒（红宝石）", image: "images/M9刺刀多普勒（红宝石）.jpg", wear: "崭新出场", probability: 0.002001, value: 19504.22, rarity: "隐秘级" },
            { name: "M9刺刀渐变大理石", image: "images/M9刺刀渐变大理石.jpg", wear: "崭新出场", probability: 0.115, value: 2220.278, rarity: "军需级" },
            { name: "M9刺刀外表生锈", image: "images/M9刺刀外表生锈.jpg", wear: "战痕累累", probability: 0.825, value: 789.57, rarity: "军需级" },
            { name: "M9刺刀自动化", image: "images/M9刺刀自动化.jpg", wear: "久经沙场", probability: 0.63, value: 1717.77, rarity: "军需级" },
            { name: "USP不锈钢", image: "images/USP不锈钢.jpg", wear: "久经沙场", probability: 10.2, value: 8.59, rarity: "工业级" },
            { name: "USP蓝图", image: "images/USP蓝图.jpg", wear: "久经沙场", probability: 15.2, value: 5.60, rarity: "工业级" },
            { name: "刺刀", image: "images/刺刀.jpg", wear: "崭新出场", probability: 0.244, value: 850.282, rarity: "军需级" },
            { name: "刺刀多普勒", image: "images/刺刀多普勒.jpg", wear: "崭新出场", probability: 0.26, value: 1005.29, rarity: "军需级" },
            { name: "刺刀虎牙", image: "images/刺刀虎牙.jpg", wear: "崭新出场", probability: 0.28, value: 850.232, rarity: "军需级" },
            { name: "格洛克水灵", image: "images/格洛克水灵.jpg", wear: "崭新出场", probability: 10.2, value: 8.73, rarity: "工业级" },
            { name: "蝴蝶刀都市伪装", image: "images/蝴蝶刀都市伪装.jpg", wear: "久经沙场", probability: 0.25, value: 990.260, rarity: "军需级" },
            { name: "蝴蝶刀多普勒（红宝石）", image: "images/蝴蝶刀多普勒（红宝石）.jpg", wear: "崭新出场", probability: 0.020001, value: 20705.43, rarity: "隐秘级" },
            { name: "蝴蝶刀多普勒", image: "images/蝴蝶刀多普勒.jpg", wear: "崭新出场", probability: 0.0002008, value: 5519.62, rarity: "隐秘级" }
        ];

        // 用户数据
        let userBalance = 3000; // 初始3000豆用于测试
        let userInventory = [];
        let redeemingItems = [];
        let redeemedItems = [];
        let rechargeHistory = [];
        let openHistory = [];
        let recentItems = [];
        let selectedRechargeAmount = 0;
        let currentWonItem = null; // 当前中奖商品
        let redeemTimers = {}; // 提货倒计时计时器

        // DOM元素
        const balanceDisplay = document.getElementById('user-balance');
        const rechargeBtn = document.getElementById('recharge-btn');
        const openOnceBtn = document.getElementById('open-once');
        const openFiveBtn = document.getElementById('open-five');
        const animationContainer = document.getElementById('animation-container');
        const fiveResultModal = document.getElementById('five-result-modal');
        const fiveResultItemsContainer = document.getElementById('five-result-items');
        const closeFiveResultBtn = document.getElementById('close-five-result');
        const itemsShowcase = document.getElementById('items-showcase');
        const recentItemsContainer = document.getElementById('recent-items');
        const inventoryBtn = document.getElementById('inventory-btn');
        const historyBtn = document.getElementById('history-btn');
        const singleResultModal = document.getElementById('single-result-modal');
        const singleResultItemsContainer = document.getElementById('single-result-items');
        const closeSingleResultBtn = document.getElementById('close-single-result');
        const convertItemBtn = document.getElementById('convert-item-btn');
        const rechargeModal = document.getElementById('recharge-modal');
        const rechargeOptions = document.querySelectorAll('.recharge-option');
        const confirmRechargeBtn = document.getElementById('confirm-recharge');
        const cancelRechargeBtn = document.getElementById('cancel-recharge');
        const inventoryModal = document.getElementById('inventory-modal');
        const inventoryItemsContainer = document.getElementById('inventory-items-container');
        const redeemingItemsContainer = document.getElementById('redeeming-items-container');
        const redeemedItemsContainer = document.getElementById('redeemed-items-container');
        const closeInventoryBtn = document.getElementById('close-inventory');
        const historyModal = document.getElementById('history-modal');
        const historyItemsContainer = document.getElementById('history-items-container');
        const closeHistoryBtn = document.getElementById('close-history');
        const bulkConvertBtn = document.getElementById('bulk-convert-btn');
        const inventoryTabs = document.querySelectorAll('.inventory-tab');
        const inventoryTabContents = document.querySelectorAll('.inventory-tab-content');
        const redeemingCount = document.getElementById('redeeming-count');
        const redeemedCount = document.getElementById('redeemed-count');

        // 初始化页面
        function initPage() {
            updateBalanceDisplay();
            loadItemsShowcase();
            loadRecentItems();
            
            // 从本地存储加载用户数据
            const savedData = localStorage.getItem('csgoBoxData');
            if (savedData) {
                const data = JSON.parse(savedData);
                userBalance = data.balance || 0;
                userInventory = data.inventory || [];
                redeemingItems = data.redeemingItems || [];
                redeemedItems = data.redeemedItems || [];
                rechargeHistory = data.rechargeHistory || [];
                openHistory = data.openHistory || [];
                recentItems = data.recentItems || [];
                
                updateBalanceDisplay();
                loadRecentItems();
                
                // 恢复提货中的计时器
                redeemingItems.forEach(item => {
                    if (item.redeemTimeLeft > 0) {
                        startRedeemTimer(item.id, item.redeemTimeLeft);
                    }
                });
            }
            
            // 初始化事件监听
            initEventListeners();
        }
        
        // 初始化事件监听
        function initEventListeners() {
            // 充值按钮点击
            rechargeBtn.addEventListener('click', () => {
                rechargeModal.style.display = 'flex';
                selectedRechargeAmount = 0;
                
                // 重置选中状态
                rechargeOptions.forEach(option => {
                    option.style.backgroundColor = '#333';
                });
            });
            
            // 充值选项点击
            rechargeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    selectedRechargeAmount = parseInt(option.dataset.amount);
                    
                    // 更新选中状态
                    rechargeOptions.forEach(opt => {
                        opt.style.backgroundColor = opt === option ? '#555' : '#333';
                    });
                });
            });
            
            // 确认充值
            confirmRechargeBtn.addEventListener('click', () => {
                if (selectedRechargeAmount > 0) {
                    userBalance += selectedRechargeAmount;
                    updateBalanceDisplay();
                    
                    // 记录充值历史
                    rechargeHistory.push({
                        amount: selectedRechargeAmount,
                        time: new Date().toLocaleString()
                    });
                    
                    saveUserData();
                    alert(`成功充值 ${selectedRechargeAmount}豆`);
                    rechargeModal.style.display = 'none';
                } else {
                    alert('请选择充值金额');
                }
            });
            
            // 取消充值
            cancelRechargeBtn.addEventListener('click', () => {
                rechargeModal.style.display = 'none';
            });
            
            // 单次开箱
            openOnceBtn.addEventListener('click', () => {
                if (userBalance < 128.88) {
                    alert('余额不足，请先充值');
                    return;
                }
                
                userBalance -= 128.88;
                updateBalanceDisplay();
                
                // 准备开箱动画
                prepareSingleAnimation();
            });
            
            // 五连抽
            openFiveBtn.addEventListener('click', () => {
                if (userBalance < 128.88 * 5) {
                    alert('余额不足，请先充值');
                    return;
                }
                
                userBalance -= 128.88 * 5;
                updateBalanceDisplay();
                
                // 重置五连抽状态
                fiveResultItems = [];
                currentFiveOpenCount = 0;
                fiveScrollContainers = [];
                
                // 准备五连抽动画
                prepareFiveAnimation();
            });
            
            // 关闭五连抽结果
            closeFiveResultBtn.addEventListener('click', () => {
                fiveResultModal.style.display = 'none';
            });
            
            // 关闭单次开箱结果
            closeSingleResultBtn.addEventListener('click', () => {
                singleResultModal.style.display = 'none';
            });
            
            // 置换商品为豆子
            convertItemBtn.addEventListener('click', () => {
                if (currentWonItem) {
                    userBalance += currentWonItem.value;
                    updateBalanceDisplay();
                    alert(`成功置换 ${currentWonItem.name} 获得 ${currentWonItem.value.toFixed(2)} 豆`);
                    singleResultModal.style.display = 'none';
                    saveUserData();
                }
            });
            
            // 打开仓库
            inventoryBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showInventory();
            });
            
            // 关闭仓库
            closeInventoryBtn.addEventListener('click', () => {
                inventoryModal.style.display = 'none';
            });
            
            // 打开历史记录
            historyBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showHistory();
            });
            
            // 关闭历史记录
            closeHistoryBtn.addEventListener('click', () => {
                historyModal.style.display = 'none';
            });
            
            // 一键分解低价值物品
            bulkConvertBtn.addEventListener('click', () => {
                const lowValueItems = userInventory.filter(item => item.value < 1000);
                if (lowValueItems.length === 0) {
                    alert('没有低于1000豆的物品可分解');
                    return;
                }
                
                if (confirm(`确定要分解所有${lowValueItems.length}件低于1000豆的物品吗？`)) {
                    let totalValue = 0;
                    lowValueItems.forEach(item => {
                        totalValue += item.value;
                    });
                    
                    userBalance += totalValue;
                    userInventory = userInventory.filter(item => item.value >= 1000);
                    
                    updateBalanceDisplay();
                    saveUserData();
                    showInventory();
                    alert(`成功分解 ${lowValueItems.length} 件物品，获得 ${totalValue.toFixed(2)} 豆`);
                }
            });
            
            // 仓库标签切换
            inventoryTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    
                    // 更新标签状态
                    inventoryTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // 更新内容区域
                    inventoryTabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}-tab`) {
                            content.classList.add('active');
                        }
                    });
                    
                    // 如果需要，加载对应标签的内容
                    if (tabId === 'redeeming') {
                        loadRedeemingItems();
                    } else if (tabId === 'redeemed') {
                        loadRedeemedItems();
                    }
                });
            });
        }
        
        // 更新余额显示
        function updateBalanceDisplay() {
            balanceDisplay.textContent = userBalance.toFixed(2);
            saveUserData();
        }
        
        // 保存用户数据到本地存储
        function saveUserData() {
            const data = {
                balance: userBalance,
                inventory: userInventory,
                redeemingItems: redeemingItems,
                redeemedItems: redeemedItems,
                rechargeHistory: rechargeHistory,
                openHistory: openHistory,
                recentItems: recentItems
            };
            localStorage.setItem('csgoBoxData', JSON.stringify(data));
        }
        
        // 加载商品展示
        function loadItemsShowcase() {
            itemsShowcase.innerHTML = '';
            
            // 按价值从高到低排序
            const sortedItems = [...items].sort((a, b) => b.value - a.value);
            
            sortedItems.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card';
                
                // 根据价值添加边框
                if (item.value > 2000) {
                    itemCard.classList.add('border-rainbow');
                } else if (item.value > 1500) {
                    itemCard.classList.add('border-orange');
                } else if (item.value > 1000) {
                    itemCard.classList.add('border-red');
                } else if (item.value > 500) {
                    itemCard.classList.add('border-purple');
                }
                
                const itemImage = document.createElement('div');
                itemImage.className = 'item-image';
                itemImage.style.backgroundImage = `url(${item.image})`;
                itemImage.innerHTML = `
                    <div class="item-badge">${item.rarity}</div>
                    <div class="item-value">${item.value.toFixed(2)} 豆</div>
                    <div class="item-wear">${item.wear}</div>
                `;
                
                const itemName = document.createElement('div');
                itemName.className = 'item-name';
                itemName.textContent = item.name;
                
                itemCard.appendChild(itemImage);
                itemCard.appendChild(itemName);
                itemsShowcase.appendChild(itemCard);
            });
        }
        
        // 加载最近出货
        function loadRecentItems() {
            recentItemsContainer.innerHTML = '';
            
            // 如果没有最近出货，显示一些示例
            if (recentItems.length === 0) {
                const exampleItems = items.filter(item => item.value > 1000)
                                         .sort(() => 0.5 - Math.random())
                                         .slice(0, 8);
                                         
                exampleItems.forEach((item, index) => {
                    recentItems.push({
                        name: item.name,
                        image: item.image,
                        value: item.value,
                        rarity: item.rarity,
                        time: (index + 1) * 5
                    });
                });
            }
            
            recentItems.slice(0, 10).forEach(item => {
                const recentItem = document.createElement('div');
                recentItem.className = 'recent-item';
                recentItem.style.backgroundImage = `url(${item.image})`;
                
                // 根据价值添加边框
                if (item.value > 2000) {
                    recentItem.classList.add('border-rainbow');
                } else if (item.value > 1500) {
                    recentItem.classList.add('border-orange');
                } else if (item.value > 1000) {
                    recentItem.classList.add('border-red');
                } else if (item.value > 500) {
                    recentItem.classList.add('border-purple');
                }
                
                recentItem.innerHTML = `
                    <div class="item-badge">${item.rarity}</div>
                    <div class="item-time">${item.time}分钟前</div>
                `;
                
                recentItemsContainer.appendChild(recentItem);
            });
        }
        
        // 获取随机商品（根据概率）
        function getRandomItem() {
            const random = Math.random() * 106;
            let cumulativeProbability = 10;
            
            for (const item of items) {
                cumulativeProbability += item.probability;
                if (random <= cumulativeProbability) {
                    return item;
                }
            }
            
            return items[items.length - 1]; // 默认返回最后一个
        }
        
        // 准备单次抽奖动画
        function prepareSingleAnimation() {
            animationContainer.style.display = 'flex';
            animationContainer.innerHTML = '';
            
            // 创建单个滚动容器
            const box = document.createElement('div');
            box.className = 'animation-box';
            box.innerHTML = `
                <div class="item-scroll" id="single-item-scroll"></div>
                <div class="pointer"></div>
            `;
            animationContainer.appendChild(box);
            
            // 生成滚动项目
            const scrollContainer = document.getElementById('single-item-scroll');
            scrollContainer.innerHTML = '';
            
            // 预先生成60个随机商品图片
            const scrollItems = [];
            for (let j = 0; j < 60; j++) {
                const randomItem = getRandomItem();
                scrollItems.push(randomItem);
            }
            
            // 确保最后一个商品是随机决定的获奖商品
            const wonItem = getRandomItem();
            scrollItems[scrollItems.length - 3] = wonItem;
            
            // 创建滚动元素
            scrollItems.forEach(item => {
                const scrollItem = document.createElement('div');
                scrollItem.className = 'scroll-item';
                scrollItem.style.backgroundImage = `url(${item.image})`;
                scrollItem.dataset.item = JSON.stringify(item);
                scrollContainer.appendChild(scrollItem);
            });
            
            // 开始单次抽奖动画
            startSingleAnimation(wonItem);
        }
        
        // 开始单次抽奖动画
        function startSingleAnimation(wonItem) {
            const scrollContainer = document.getElementById('single-item-scroll');
            const scrollWidth = scrollContainer.scrollWidth;
            const containerWidth = scrollContainer.clientWidth;
            const targetScrollLeft = scrollWidth - containerWidth;
            
            let startTime = null;
            const duration = 5000;
            
            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = timestamp - startTime;
                const percentage = Math.min(progress / duration, 1);
                
                // 缓动函数 - 先快后慢
                const easing = 1 - Math.pow(1 - percentage, 3);
                
                scrollContainer.scrollLeft = easing * targetScrollLeft;
                
                if (progress < duration) {
                    requestAnimationFrame(animate);
                } else {
                    // 动画结束
                    setTimeout(() => {
                        // 添加到用户仓库
                        userInventory.push(wonItem);
                        
                        // 记录开箱历史
                        openHistory.push({
                            item: wonItem.name,
                            value: wonItem.value,
                            time: new Date().toLocaleString()
                        });
                        
                        // 如果价值大于500，添加到最近出货
                        if (wonItem.value > 500) {
                            recentItems.unshift({
                                name: wonItem.name,
                                image: wonItem.image,
                                value: wonItem.value,
                                rarity: wonItem.rarity,
                                time: 0
                            });
                            
                            if (recentItems.length > 8) {
                                recentItems.pop();
                            }
                        }
                        
                        saveUserData();
                        animationContainer.style.display = 'none';
                        showSingleResult(wonItem);
                        loadRecentItems();
                    }, 500);
                }
            }
            
            requestAnimationFrame(animate);
        }
        
        // 显示单次开箱结果
        function showSingleResult(item) {
            currentWonItem = item;
            const singleResultContainer = document.getElementById('single-result-items');
            singleResultContainer.innerHTML = '';
            
            const resultItem = document.createElement('div');
            resultItem.className = 'result-item';
            
            const itemImage = document.createElement('div');
            itemImage.className = 'result-image';
            itemImage.style.backgroundImage = `url(${item.image})`;
            itemImage.innerHTML = `
                <div class="result-value">${item.value.toFixed(2)} 豆</div>
                <div class="item-badge" style="top: 5px; right: 5px;">${item.rarity}</div>
            `;
            
            const itemName = document.createElement('div');
            itemName.className = 'result-name';
            itemName.textContent = `${item.name} (${item.wear})`;
            
            resultItem.appendChild(itemImage);
            resultItem.appendChild(itemName);
            singleResultContainer.appendChild(resultItem);
            
            // 显示置换按钮
            convertItemBtn.style.display = 'block';
            
            singleResultModal.style.display = 'flex';
        }
        
        // 准备五连抽动画
        function prepareFiveAnimation() {
            animationContainer.style.display = 'flex';
            animationContainer.innerHTML = '';
            
            // 创建五个独立的滚动容器
            for (let i = 0; i < 5; i++) {
                const box = document.createElement('div');
                box.className = 'animation-box';
                box.innerHTML = `
                    <div class="item-scroll" id="item-scroll-${i}"></div>
                    <div class="pointer"></div>
                `;
                animationContainer.appendChild(box);
                
                // 生成滚动项目
                const scrollContainer = document.getElementById(`item-scroll-${i}`);
                scrollContainer.innerHTML = '';
                
                // 预先生成60个随机商品图片
                const scrollItems = [];
                for (let j = 0; j < 60; j++) {
                    const randomItem = getRandomItem();
                    scrollItems.push(randomItem);
                }
                
                // 确保最后一个商品是随机决定的获奖商品
                const wonItem = getRandomItem();
                scrollItems[scrollItems.length - 3] = wonItem;
                
                // 创建滚动元素
                scrollItems.forEach(item => {
                    const scrollItem = document.createElement('div');
                    scrollItem.className = 'scroll-item';
                    scrollItem.style.backgroundImage = `url(${item.image})`;
                    scrollItem.dataset.item = JSON.stringify(item);
                    scrollContainer.appendChild(scrollItem);
                });
                
                // 存储滚动容器和获奖商品
                fiveScrollContainers.push({
                    container: scrollContainer,
                    wonItem: wonItem
                });
            }
            
            // 开始五连抽动画
            startFiveAnimation();
        }
        
        // 开始五连抽动画
        function startFiveAnimation() {
            // 依次启动五个动画，每个间隔300ms
            fiveScrollContainers.forEach((scrollData, index) => {
                setTimeout(() => {
                    const scrollContainer = scrollData.container;
                    const scrollWidth = scrollContainer.scrollWidth;
                    const containerWidth = scrollContainer.clientWidth;
                    const targetScrollLeft = scrollWidth - containerWidth;
                    
                    let startTime = null;
                    const duration = 5000 + index * 800; // 每个动画持续时间递增
                    
                    function animate(timestamp) {
                        if (!startTime) startTime = timestamp;
                        const progress = timestamp - startTime;
                        const percentage = Math.min(progress / duration, 1);
                        
                        // 缓动函数 - 先快后慢
                        const easing = 1 - Math.pow(1 - percentage, 3);
                        
                        scrollContainer.scrollLeft = easing * targetScrollLeft;
                        
                        if (progress < duration) {
                            requestAnimationFrame(animate);
                        } else {
                            // 动画结束
                            setTimeout(() => {
                                // 获取获奖商品
                                const wonItem = scrollData.wonItem;
                                fiveResultItems.push(wonItem);
                                currentFiveOpenCount++;
                                
                                // 记录开箱历史
                                openHistory.push({
                                    item: wonItem.name,
                                    value: wonItem.value,
                                    time: new Date().toLocaleString()
                                });
                                
                                // 添加到用户仓库
                                userInventory.push(wonItem);
                                
                                // 检查是否所有抽奖都完成
                                if (currentFiveOpenCount === 5) {
                                    setTimeout(() => {
                                        animationContainer.style.display = 'none';
                                        showFiveResults();
                                        saveUserData();
                                    }, 500);
                                }
                            }, 500);
                        }
                    }
                    
                    requestAnimationFrame(animate);
                }, index * 300); // 每个动画间隔300ms
            });
        }
        
        // 显示五连抽结果
        function showFiveResults() {
            const fiveResultContainer = document.getElementById('five-result-items');
            fiveResultContainer.innerHTML = '';
            
            fiveResultItems.forEach(item => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                
                const itemImage = document.createElement('div');
                itemImage.className = 'result-image';
                itemImage.style.backgroundImage = `url(${item.image})`;
                itemImage.innerHTML = `
                    <div class="result-value">${item.value.toFixed(2)} 豆</div>
                    <div class="item-badge" style="top: 5px; right: 5px;">${item.rarity}</div>
                `;
                
                const itemName = document.createElement('div');
                itemName.className = 'result-name';
                itemName.textContent = `${item.name} (${item.wear})`;
                
                resultItem.appendChild(itemImage);
                resultItem.appendChild(itemName);
                fiveResultContainer.appendChild(resultItem);
                
                // 如果价值大于1000，添加到最近出货
                if (item.value > 1000) {
                    recentItems.unshift({
                        name: item.name,
                        image: item.image,
                        value: item.value,
                        rarity: item.rarity,
                        time: 0
                    });
                    
                    if (recentItems.length > 8) {
                        recentItems.pop();
                    }
                }
            });
            
            fiveResultModal.style.display = 'flex';
            loadRecentItems();
        }
        
        // 显示仓库
        function showInventory() {
            inventoryItemsContainer.innerHTML = '';
            
            if (userInventory.length === 0) {
                inventoryItemsContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">仓库空空如也，快去开箱吧！</p>';
                inventoryModal.style.display = 'flex';
                return;
            }
            
            // 按价值从高到低排序
            const sortedInventory = [...userInventory].sort((a, b) => b.value - a.value);
            
            sortedInventory.forEach((item, index) => {
                const inventoryItem = document.createElement('div');
                inventoryItem.className = 'result-item';
                
                const itemImage = document.createElement('div');
                itemImage.className = 'result-image';
                itemImage.style.backgroundImage = `url(${item.image})`;
                itemImage.innerHTML = `
                    <div class="result-value">${item.value.toFixed(2)} 豆</div>
                    <div class="item-badge" style="top: 5px; right: 5px;">${item.rarity}</div>
                `;
                
                const itemName = document.createElement('div');
                itemName.className = 'result-name';
                itemName.textContent = `${item.name} (${item.wear})`;
                
                const itemActions = document.createElement('div');
                itemActions.className = 'item-actions';
                
                const redeemBtn = document.createElement('button');
                redeemBtn.className = 'item-action-btn redeem-btn';
                redeemBtn.textContent = '提货';
                redeemBtn.addEventListener('click', () => {
                    startRedeemProcess(index);
                });
                
                const convertBtn = document.createElement('button');
                convertBtn.className = 'item-action-btn convert-btn';
                convertBtn.textContent = '置换';
                convertBtn.addEventListener('click', () => {
                    convertItemToBeans(index);
                });
                
                itemActions.appendChild(redeemBtn);
                itemActions.appendChild(convertBtn);
                
                inventoryItem.appendChild(itemImage);
                inventoryItem.appendChild(itemName);
                inventoryItem.appendChild(itemActions);
                inventoryItemsContainer.appendChild(inventoryItem);
            });
            
            // 更新提货中数量和已提货数量
            redeemingCount.textContent = redeemingItems.length;
            redeemedCount.textContent = redeemedItems.length;
            
            inventoryModal.style.display = 'flex';
        }
        
        // 加载提货中物品
        function loadRedeemingItems() {
            redeemingItemsContainer.innerHTML = '';
            
            if (redeemingItems.length === 0) {
                redeemingItemsContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">没有正在提货中的物品</p>';
                return;
            }
            
            redeemingItems.forEach((item, index) => {
                const redeemingItem = document.createElement('div');
                redeemingItem.className = 'result-item';
                
                const itemImage = document.createElement('div');
                itemImage.className = 'result-image';
                itemImage.style.backgroundImage = `url(${item.image})`;
                itemImage.innerHTML = `
                    <div class="result-value">${item.value.toFixed(2)} 豆</div>
                    <div class="item-badge" style="top: 5px; right: 5px;">${item.rarity}</div>
                `;
                
                const itemName = document.createElement('div');
                itemName.className = 'result-name';
                itemName.textContent = `${item.name} (${item.wear})`;
                
                const timeLeft = document.createElement('div');
                timeLeft.className = 'result-name';
                timeLeft.style.fontSize = '12px';
                timeLeft.textContent = `剩余时间: ${formatTime(item.redeemTimeLeft)}`;
                
                redeemingItem.appendChild(itemImage);
                redeemingItem.appendChild(itemName);
                redeemingItem.appendChild(timeLeft);
                redeemingItemsContainer.appendChild(redeemingItem);
            });
        }
        
        // 加载已提货物品
        function loadRedeemedItems() {
            redeemedItemsContainer.innerHTML = '';
            
            if (redeemedItems.length === 0) {
                redeemedItemsContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">没有已提货的物品</p>';
                return;
            }
            
            redeemedItems.forEach(item => {
                const redeemedItem = document.createElement('div');
                redeemedItem.className = 'result-item';
                
                const itemImage = document.createElement('div');
                itemImage.className = 'result-image';
                itemImage.style.backgroundImage = `url(${item.image})`;
                itemImage.innerHTML = `
                    <div class="result-value">${item.value.toFixed(2)} 豆</div>
                    <div class="item-badge" style="top: 5px; right: 5px;">${item.rarity}</div>
                `;
                
                const itemName = document.createElement('div');
                itemName.className = 'result-name';
                itemName.textContent = `${item.name} (${item.wear})`;
                
                const redeemTime = document.createElement('div');
                redeemTime.className = 'result-name';
                redeemTime.style.fontSize = '12px';
                redeemTime.textContent = `提货时间: ${item.redeemTime}`;
                
                redeemedItem.appendChild(itemImage);
                redeemedItem.appendChild(itemName);
                redeemedItem.appendChild(redeemTime);
                redeemedItemsContainer.appendChild(redeemedItem);
            });
        }
        
        // 开始提货流程
        function startRedeemProcess(index) {
            const item = userInventory[index];
            if (!item) return;
            
            if (confirm(`确定要提货 ${item.name} 吗？提货需要10分钟处理时间`)) {
                // 从库存中移除
                userInventory.splice(index, 1);
                
                // 添加到提货中列表
                const redeemItem = {
                    ...item,
                    id: Date.now() + Math.random().toString(36).substr(2, 9),
                    redeemTimeLeft: 600 // 10分钟 = 600秒
                };
                
                redeemingItems.push(redeemItem);
                
                // 开始倒计时
                startRedeemTimer(redeemItem.id, redeemItem.redeemTimeLeft);
                
                // 更新UI
                saveUserData();
                showInventory();
                alert('提货申请已提交，请耐心等待处理');
            }
        }
        
        // 开始提货倒计时
        function startRedeemTimer(itemId, initialTimeLeft) {
            // 清除已有的计时器
            if (redeemTimers[itemId]) {
                clearInterval(redeemTimers[itemId]);
            }
            
            let timeLeft = initialTimeLeft;
            
            // 更新提货中物品的时间
            const updateRedeemingItem = () => {
                const itemIndex = redeemingItems.findIndex(item => item.id === itemId);
                if (itemIndex !== -1) {
                    redeemingItems[itemIndex].redeemTimeLeft = timeLeft;
                    saveUserData();
                    
                    // 如果倒计时结束
                    if (timeLeft <= 0) {
                        completeRedeem(itemId);
                        clearInterval(redeemTimers[itemId]);
                        delete redeemTimers[itemId];
                    }
                }
            };
            
            // 初始更新
            updateRedeemingItem();
            
            // 设置计时器
            redeemTimers[itemId] = setInterval(() => {
                timeLeft--;
                updateRedeemingItem();
            }, 1000);
        }
        
        // 完成提货
        function completeRedeem(itemId) {
            const itemIndex = redeemingItems.findIndex(item => item.id === itemId);
            if (itemIndex !== -1) {
                const item = redeemingItems[itemIndex];
                
                // 从提货中移除
                redeemingItems.splice(itemIndex, 1);
                
                // 添加到已提货列表
                redeemedItems.push({
                    ...item,
                    redeemTime: new Date().toLocaleString()
                });
                
                // 更新UI
                saveUserData();
                
                // 如果仓库模态框是打开的，更新显示
                if (inventoryModal.style.display === 'flex') {
                    const activeTab = document.querySelector('.inventory-tab.active');
                    if (activeTab && activeTab.dataset.tab === 'redeeming') {
                        loadRedeemingItems();
                    }
                    
                    // 更新计数
                    redeemingCount.textContent = redeemingItems.length;
                    redeemedCount.textContent = redeemedItems.length;
                }
            }
        }
        
        // 格式化时间
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // 置换物品为豆子
        function convertItemToBeans(index) {
            const item = userInventory[index];
            if (!item) return;
            
            if (confirm(`确定要将 ${item.name} 置换为 ${item.value.toFixed(2)} 豆吗？`)) {
                userBalance += item.value;
                userInventory.splice(index, 1);
                
                updateBalanceDisplay();
                saveUserData();
                showInventory();
                alert(`成功置换 ${item.name} 获得 ${item.value.toFixed(2)} 豆`);
            }
        }
        
        // 显示历史记录
        function showHistory() {
            historyItemsContainer.innerHTML = '';
            
            if (openHistory.length === 0) {
                historyItemsContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">暂无开箱记录</p>';
                historyModal.style.display = 'flex';
                return;
            }
            
            // 按时间从新到旧排序
            const sortedHistory = [...openHistory].reverse();
            
            sortedHistory.forEach(record => {
                const historyItem = document.createElement('div');
                historyItem.className = 'result-item';
                historyItem.style.padding = '10px';
                
                const itemName = document.createElement('div');
                itemName.className = 'result-name';
                itemName.textContent = `${record.item}`;
                itemName.style.fontWeight = 'bold';
                itemName.style.marginBottom = '5px';
                
                const itemDetails = document.createElement('div');
                itemDetails.style.display = 'flex';
                itemDetails.style.justifyContent = 'space-between';
                
                const itemValue = document.createElement('div');
                itemValue.textContent = `${record.value.toFixed(2)} 豆`;
                
                const itemTime = document.createElement('div');
                itemTime.textContent = record.time;
                itemTime.style.color = '#aaa';
                itemTime.style.fontSize = '12px';
                
                itemDetails.appendChild(itemValue);
                itemDetails.appendChild(itemTime);
                
                historyItem.appendChild(itemName);
                historyItem.appendChild(itemDetails);
                historyItemsContainer.appendChild(historyItem);
            });
            
            historyModal.style.display = 'flex';
        }
        
        // 初始化页面
        initPage();
    </script>
</body>
</html>
